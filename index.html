<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digitale Plantafel Freylich</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f5fa;
      margin: 0;
      padding: 0;
      color: #222;
    }
    header {
      background: #fff;
      border-bottom: 2px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      font-size: 20px;
      margin: 0;
    }
    .btn {
      background: #1565c0;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 14px;
      margin-left: 5px;
    }
    .btn.secondary {
      background: #e0e0e0;
      color: #000;
    }
    .container {
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: 20px;
      margin: 20px;
    }
    .day {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }
    .day h3 {
      margin-top: 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      color: #1565c0;
    }
    .panel {
      background: #fff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .muted { color: #666; font-size: 13px; }
    dialog {
      border: none;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

<header>
  <h1>Digitale Plantafel Freylich</h1>
  <div>
    <button id="btnPrev" class="btn secondary">←</button>
    <button id="btnToday" class="btn secondary">Heute</button>
    <button id="btnNext" class="btn secondary">→</button>
    <button id="btnLogin" class="btn">Anmelden</button>
  </div>
</header>

<main class="container">
  <section>
    <div id="days"></div>
  </section>
  <aside class="panel">
    <h3>Extras</h3>
    <div id="adminPanel" class="hidden">
      <button id="btnAdd" class="btn">+ Kleinbaustelle</button>
      <button id="btnData" class="btn secondary">Stammdaten</button>
    </div>
    <p class="muted">Mitarbeiter sehen nur Lesedaten.</p>
  </aside>
</main>

<dialog id="dlgLogin">
  <form method="dialog">
    <h3>Admin Login</h3>
    <input type="email" id="email" placeholder="E-Mail-Adresse" />
    <input type="password" id="password" placeholder="Passwort" />
    <button id="doLogin" class="btn">Anmelden</button>
    <button class="btn secondary" value="cancel">Abbrechen</button>
    <p id="loginMsg" class="muted"></p>
  </form>
</dialog>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { 
    getAuth, signInWithEmailAndPassword, signInAnonymously, signOut, onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

 const firebaseConfig = {
  apiKey: "AIzaSyAqxqRI3ixV-vQttjiaaHnkmIQ5Vgrva3U",
  authDomain: "plantafel-freylich.firebaseapp.com",
  projectId: "plantafel-freylich",
  storageBucket: "plantafel-freylich.firebasestorage.app",
  messagingSenderId: "428812257773",
  appId: "1:428812257773:web:d60db9f0c3075a1bff3fe4",
  measurementId: "G-MNGGTFK53R"
};

  };

  const ADMIN_EMAILS = [
    "herbert.frey@bedachungen-frey.de",
    "thomas.frey@bedachungen-frey.de",
    "patrick.thieme@bedachungen-frey.de"
  ];

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const btnLogin = document.getElementById("btnLogin");
  const dlgLogin = document.getElementById("dlgLogin");
  const doLogin = document.getElementById("doLogin");
  const adminPanel = document.getElementById("adminPanel");
  const loginMsg = document.getElementById("loginMsg");
  let isAdmin = false;

  // Montag–Freitag anzeigen
  function getMonday(d) {
    const date = new Date(d);
    const day = date.getDay();
    const diff = (day <= 0 ? -6 : 1) - day;
    date.setDate(date.getDate() + diff);
    return date;
  }

  function addDays(date, days) {
    const d = new Date(date);
    d.setDate(d.getDate() + days);
    return d;
  }

  function formatDate(d) {
    return d.toLocaleDateString("de-DE", { weekday: "long", day: "2-digit", month: "2-digit" });
  }

  function renderWeek() {
    const daysEl = document.getElementById("days");
    daysEl.innerHTML = "";
    let monday = getMonday(new Date());
    for (let i = 0; i < 5; i++) {
      const day = addDays(monday, i);
      const div = document.createElement("div");
      div.className = "day";
      div.innerHTML = `<h3>${formatDate(day)}</h3><p class='muted'>Noch keine Einträge</p>`;
      daysEl.appendChild(div);
    }
  }

  // Authentifizierung
  signInAnonymously(auth);

  onAuthStateChanged(auth, (user) => {
    isAdmin = user && user.email && ADMIN_EMAILS.includes(user.email);
    adminPanel.classList.toggle("hidden", !isAdmin);
  });

  btnLogin.onclick = () => {
    if (isAdmin) {
      signOut(auth);
      alert("Abgemeldet.");
    } else {
      dlgLogin.showModal();
    }
  };

  doLogin.onclick = async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    loginMsg.textContent = "Anmeldung läuft...";
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      loginMsg.textContent = "Erfolgreich angemeldet.";
      setTimeout(() => dlgLogin.close(), 500);
    } catch (err) {
      loginMsg.textContent = "Fehler: " + err.message;
    }
  };

<script type="module">
  renderWeek();
</script>
</body>
</html>


